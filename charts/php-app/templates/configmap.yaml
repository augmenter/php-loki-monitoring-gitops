apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "php-app.fullname" . }}-content
  labels:
    {{- include "php-app.labels" . | nindent 4 }}
data:
  index.php: |
    <?php
    // Log to stdout so it appears in container logs
function logMessage($message) {
    file_put_contents('php://stdout', 
        "[" . date('Y-m-d H:i:s') . "] " . $message . PHP_EOL
    );
}
    
    function randomError() {
        $chance = rand(1, 5);
        if ($chance === 1) {
            $errorMessages = [
                "Error: File not found!",
                "Error: Invalid input detected!",
                "Error: Permission denied!",
                "Error: Database connection failed!",
                "Error: Out of memory!"
            ];
            
            $error = $errorMessages[array_rand($errorMessages)];
            logMessage("xRANDOM_ERROR: " . $error);
        } else {
            logMessage("xSUCCESS: No error this time. Everything is running smoothly!");
        }
    }
    
    // Log page request
    logMessage("PAGE_REQUEST: User accessed index.php from " . $_SERVER['REMOTE_ADDR']);
    
    echo "<h1>Hello World!</h1>";
    echo "<p>Current time: " . date('Y-m-d H:i:s') . "</p>";
    echo "<p>Server: " . ($_SERVER['SERVER_NAME'] ?? 'localhost') . "</p>";
    
    randomError();
    
    // Log completion
    logMessage("PAGE_COMPLETE: Request processing finished");
    ?>
